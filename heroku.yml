build:
  docker:
    web: Dockerfile

release:
  image: web
  command:
    - bundle exec rake db:migrate 2>/dev/null || bundle exec rake db:create db:migrate
    - bundle exec rails assets:precompile
    # To solve: Errno::ENOENT: No such file or directory @ rb_sysopen - tmp/pids/server.pid
    - mkdir tmp && mkdir tmp/pids
run:
  web: bundle exec puma -t 5:5 -p ${PORT:-3000} -e ${RACK_ENV:-production}